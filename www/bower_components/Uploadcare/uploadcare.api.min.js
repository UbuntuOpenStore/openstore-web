/*
 * Uploadcare (2.9.0)
 * Date: 2016-05-13 16:51:44 +0000
 * Rev: 55ded7fe23
 */
!function(e,t){e.document&&("object"==typeof module&&module.exports?module.exports=t(e,require("jquery")):e.uploadcare=t(e))}("undefined"!=typeof window?window:this,function(e,t){var n,r=e.document;return function(){n={__exports:{}},n.namespace=function(e,t){var i,r,o,s,a;if(r=n,e)for(a=e.split("."),o=0,s=a.length;s>o;o++)i=a[o],r[i]||(r[i]={}),r=r[i];return t(r)},n.expose=function(e,t){var i,r,o,s,a,u,l;for(o=e.split("."),i=o.pop(),a=n.__exports,s=n,u=0,l=o.length;l>u;u++)r=o[u],a[r]||(a[r]={}),a=a[r],s=null!=s?s[r]:void 0;return a[i]=t||s[i]}}.call(this),function(){var i;if(n.version="2.9.0",n.jQuery=t||e.jQuery,"undefined"==typeof n.jQuery)throw new ReferenceError("jQuery is not defined");i=n.expose,i("version"),i("jQuery"),i("plugin",function(e){return e(n)})}.call(this),e.XDomainRequest&&n.jQuery.ajaxTransport(function(e){if(e.crossDomain&&e.async){e.timeout&&(e.xdrTimeout=e.timeout,delete e.timeout);var t;return{send:function(n,i){function r(e,n,r,o){t.onload=t.onerror=t.ontimeout=function(){},t=void 0,i(e,n,r,o)}t=new XDomainRequest,t.onload=function(){r(200,"OK",{text:t.responseText},"Content-Type: "+t.contentType)},t.onerror=function(){r(404,"Not Found")},t.onprogress=function(){},t.ontimeout=function(){r(0,"timeout")},t.timeout=e.xdrTimeout||Number.MAX_VALUE,t.open(e.type,e.url.replace(/^https?:/,"")),t.send(e.hasContent&&e.data||null)},abort:function(){t&&(t.onerror=function(){},t.abort())}}}}),function(){n.namespace("utils.abilities",function(t){var n,i,o,s;t.fileAPI=!!(e.File&&e.FileList&&e.FileReader),t.sendFileAPI=!(!e.FormData||!t.fileAPI),t.dragAndDrop=function(){var e;return e=r.createElement("div"),"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),t.canvas=function(){var e;return e=r.createElement("canvas"),!(!e.getContext||!e.getContext("2d"))}(),t.fileDragAndDrop=t.fileAPI&&t.dragAndDrop,t.iOSVersion=null,(n=/^[^(]+\(iP(?:hone|od|ad);\s*(.+?)\)/.exec(navigator.userAgent))&&(o=/OS (\d)_(\d)/.exec(n[1]))&&(t.iOSVersion=+o[1]+o[2]/10),t.Blob=!1;try{new e.Blob&&(t.Blob=e.Blob)}catch(a){}return i=e.URL||e.webkitURL||!1,t.URL=i&&i.createObjectURL&&i,t.FileReader=(null!=(s=e.FileReader)?s.prototype.readAsArrayBuffer:void 0)&&e.FileReader})}.call(this),function(){var e,t={}.hasOwnProperty,i=function(e,n){for(var i in n)t.call(n,i)&&(e[i]=n[i]);function r(){this.constructor=e}return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},r=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},o=function(e,t){return function(){return e.apply(t,arguments)}},s=[].slice;e=n.jQuery,n.namespace("utils",function(t){var n;return t.Collection=function(){function t(t){var n,i,r;for(null==t&&(t=[]),this.onAdd=e.Callbacks(),this.onRemove=e.Callbacks(),this.onSort=e.Callbacks(),this.onReplace=e.Callbacks(),this.__items=[],i=0,r=t.length;r>i;i++)n=t[i],this.add(n)}return t.prototype.add=function(e){return this.__add(e,this.__items.length)},t.prototype.__add=function(e,t){return this.__items.splice(t,0,e),this.onAdd.fire(e,t)},t.prototype.remove=function(t){var n;return n=e.inArray(t,this.__items),-1!==n?this.__remove(t,n):void 0},t.prototype.__remove=function(e,t){return this.__items.splice(t,1),this.onRemove.fire(e,t)},t.prototype.clear=function(){var e,t,n,i,r,o;for(n=this.get(),this.__items.length=0,o=[],e=i=0,r=n.length;r>i;e=++i)t=n[e],o.push(this.onRemove.fire(t,e));return o},t.prototype.replace=function(t,n){var i;return t!==n&&(i=e.inArray(t,this.__items),-1!==i)?this.__replace(t,n,i):void 0},t.prototype.__replace=function(e,t,n){return this.__items[n]=t,this.onReplace.fire(e,t,n)},t.prototype.sort=function(e){return this.__items.sort(e),this.onSort.fire()},t.prototype.get=function(e){return null!=e?this.__items[e]:this.__items.slice(0)},t.prototype.length=function(){return this.__items.length},t}(),t.UniqCollection=function(e){i(t,e);function t(){return n=t.__super__.constructor.apply(this,arguments)}return t.prototype.add=function(e){return r.call(this.__items,e)>=0?void 0:t.__super__.add.apply(this,arguments)},t.prototype.__replace=function(e,n,i){return r.call(this.__items,n)>=0?this.remove(e):t.__super__.__replace.apply(this,arguments)},t}(t.Collection),t.CollectionOfPromises=function(t){i(n,t);function n(){this.onAnyProgress=o(this.onAnyProgress,this),this.onAnyFail=o(this.onAnyFail,this),this.onAnyDone=o(this.onAnyDone,this),this.anyDoneList=e.Callbacks(),this.anyFailList=e.Callbacks(),this.anyProgressList=e.Callbacks(),this.anyProgressList.add(function(t,n){return e(t).data("lastProgress",n)}),n.__super__.constructor.apply(this,arguments)}return n.prototype.onAnyDone=function(e){var t,n,i,r,o;for(this.anyDoneList.add(e),r=this.__items,o=[],n=0,i=r.length;i>n;n++)t=r[n],"resolved"===t.state()?o.push(t.done(function(){return e.apply(null,[t].concat(s.call(arguments)))})):o.push(void 0);return o},n.prototype.onAnyFail=function(e){var t,n,i,r,o;for(this.anyFailList.add(e),r=this.__items,o=[],n=0,i=r.length;i>n;n++)t=r[n],"rejected"===t.state()?o.push(t.fail(function(){return e.apply(null,[t].concat(s.call(arguments)))})):o.push(void 0);return o},n.prototype.onAnyProgress=function(t){var n,i,r,o,s;for(this.anyProgressList.add(t),o=this.__items,s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(t(n,e(n).data("lastProgress")));return s},n.prototype.lastProgresses=function(){var t,n,i,r,o;for(r=this.__items,o=[],n=0,i=r.length;i>n;n++)t=r[n],o.push(e(t).data("lastProgress"));return o},n.prototype.add=function(e){return e&&e.then?(n.__super__.add.apply(this,arguments),this.__watchItem(e)):void 0},n.prototype.__replace=function(e,t,i){return t&&t.then?(n.__super__.__replace.apply(this,arguments),this.__watchItem(t)):this.remove(e)},n.prototype.__watchItem=function(e){var t,n=this;return t=function(t){return function(){return r.call(n.__items,e)>=0?t.fire.apply(t,[e].concat(s.call(arguments))):void 0}},e.then(t(this.anyDoneList),t(this.anyFailList),t(this.anyProgressList))},n}(t.UniqCollection)})}.call(this),function(){var t=[].slice;n.namespace("utils",function(n){var i,r;return n.log=function(){var t;return null!=(t=e.console)&&"function"==typeof t.log?t.log.apply(t,arguments):void 0},n.debug=function(){var i,r;return(null!=(i=e.console)?i.debug:void 0)?(r=e.console).debug.apply(r,arguments):n.log.apply(n,["Debug:"].concat(t.call(arguments)))},n.warn=function(){var i,r;return(null!=(i=e.console)?i.warn:void 0)?(r=e.console).warn.apply(r,arguments):n.log.apply(n,["Warning:"].concat(t.call(arguments)))},r={},n.warnOnce=function(e){return null==r[e]?(r[e]=!0,n.warn(e)):void 0},i={publicKey:"Global public key not set. Uploads may not work!\nAdd this to the <head> tag to set your key:\n\n<script>\nUPLOADCARE_PUBLIC_KEY = 'your_public_key';\n</script>"},n.commonWarning=function(e){return null!=i[e]?n.warnOnce(i[e]):void 0}})}.call(this),function(){var t;t=n.jQuery,n.namespace("utils",function(n){var i,r=this;return i={},t(e).on("message",function(e){var t,n,r,o,s,a,u;t=e.originalEvent;try{r=JSON.parse(t.data)}catch(l){return}if(r.type in i){for(a=i[r.type],u=[],o=0,s=a.length;s>o;o++)n=a[o],t.source===n[0]?u.push(n[1](r)):u.push(void 0);return u}}),n.registerMessage=function(e,t,n){return e in i||(i[e]=[]),i[e].push([t,n])},n.unregisterMessage=function(e,n){return e in i?i[e]=t.grep(i[e],function(e){return e[0]!==n}):void 0}})}.call(this),function(){var e,t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},i=[].slice;e=n.jQuery,n.namespace("utils",function(n){var o;return n.unique=function(e){var n,i,r,o;for(i=[],r=0,o=e.length;o>r;r++)n=e[r],t.call(i,n)<0&&i.push(n);return i},n.imageLoader=function(t){var n;return n=e.Deferred(),e(new Image).on("load",n.resolve).on("error",n.reject).attr("src",t),n.promise()},n.videoLoader=function(t){var n;return n=e.Deferred(),e("<video/>").on("loadeddata",n.resolve).on("error",n.reject).attr("src",t).load(),n.promise()},n.defer=function(e){return setTimeout(e,0)},n.gcd=function(e,t){var n;while(t)n=e%t,e=t,t=n;return e},n.once=function(e){var t,n;return t=!1,n=null,function(){return t||(n=e.apply(this,arguments),t=!0),n}},n.wrapToPromise=function(t){return e.Deferred().resolve(t).promise()},n.then=function(t,n,i,r){
var o,s;return s=e.Deferred(),o=function(e,t){return e&&t?function(){return t.call(this,e.apply(this,arguments))}:e||t},t.then(o(n,s.resolve),o(i,s.reject),o(r,s.notify)),s.promise()},n.bindAll=function(t,n){var i;return i={},e.each(n,function(n,r){var o;return o=t[r],e.isFunction(o)?i[r]=function(){var e;return e=o.apply(t,arguments),e===t?i:e}:i[r]=o}),i},n.upperCase=function(e){return e.replace(/([A-Z])/g,"_$1").toUpperCase()},n.publicCallbacks=function(e){var t;return t=e.add,t.add=e.add,t.remove=e.remove,t},n.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t,n;return t=16*Math.random()|0,n="x"===e?t:3&t|8,n.toString(16)})},n.splitUrlRegex=/^(?:([^:\/?#]+):)?(?:\/\/([^\/?\#]*))?([^?\#]*)\??([^\#]*)\#?(.*)$/,n.uuidRegex=/[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}/i,n.groupIdRegex=new RegExp(""+n.uuidRegex.source+"~[0-9]+","i"),n.cdnUrlRegex=new RegExp("^/?("+n.uuidRegex.source+")(?:/(-/(?:[^/]+/)+)?([^/]*))?$","i"),n.splitCdnUrl=function(e){return n.cdnUrlRegex.exec(n.splitUrlRegex.exec(e)[3])},n.escapeRegExp=function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},n.globRegexp=function(t,i){var r;return null==i&&(i="i"),r=e.map(t.split("*"),n.escapeRegExp),new RegExp("^"+r.join(".+")+"$",i)},n.normalizeUrl=function(e){var t;return t=r.location.protocol,"http:"!==t&&(t="https:"),e.replace(/^\/\//,t+"//").replace(/\/+$/,"")},n.fitText=function(e,t){var n,i;return e.length>t?(n=Math.ceil((t-3)/2),i=Math.floor((t-3)/2),e.slice(0,n)+"..."+e.slice(-i)):e},n.fitSizeInCdnLimit=function(e){return n.fitSize(e,[2048,2048])},n.fitSize=function(e,t,n){var i,r;return e[0]>t[0]||e[1]>t[1]||n?(r=t[0]/e[0],i=t[1]/e[1],!t[0]||t[1]&&r>i?[Math.round(i*e[0]),t[1]]:[t[0],Math.round(r*e[1])]):e.slice()},n.applyCropSelectionToFile=function(e,t,n,i){var r,o,s,a,u,l,c,p=this;return l=i.width,o=i.height,a=t.preferedSize,s="",c=l===n[0]&&o===n[1],c||(s+="-/crop/"+l+"x"+o+"/"+i.left+","+i.top+"/"),r=t.downscale&&(l>a[0]||o>a[1]),u=t.upscale&&(l<a[0]||o<a[1]),r||u?(i.sw=a[0],i.sh=a[1],s+="-/resize/"+a.join("x")+"/"):c||(s+="-/preview/"),e.then(function(e){return e.cdnUrlModifiers=s,e.cdnUrl=""+e.originalUrl+(s||""),e.crop=i,e})},n.fileInput=function(t,n,i){var r,o,s;return o=null,r=n.inputAcceptTypes,""===r&&(r=n.imagesOnly?"image/*":null),(s=function(){return o=e(n.multiple?'<input type="file" multiple>':'<input type="file">').attr("accept",r).css({position:"absolute",top:0,opacity:0,margin:0,padding:0,width:"auto",height:"auto",cursor:t.css("cursor")}).on("change",function(){return i(this),e(this).hide(),s()}),t.append(o)})(),t.css({position:"relative",overflow:"hidden"}).mousemove(function(t){var n,i,r,s;return s=e(this).offset(),n=s.left,i=s.top,r=o.width(),o.css({left:t.pageX-n-r+10,top:t.pageY-i-10})})},n.fileSelectDialog=function(t,n,i){var r;return r=n.inputAcceptTypes,""===r&&(r=n.imagesOnly?"image/*":null),e(n.multiple?'<input type="file" multiple>':'<input type="file">').attr("accept",r).css({position:"fixed",bottom:0,opacity:0}).on("change",function(){return i(this),e(this).remove()}).appendTo(t).focus().click().hide()},n.fileSizeLabels="B KB MB GB TB PB EB ZB YB".split(" "),n.readableFileSize=function(e,t,i,r){var o,s,a,u;if(null==t&&(t=""),null==i&&(i=""),null==r&&(r=""),e=parseInt(e,10),isNaN(e))return t;o=2,a=0,u=1e3-5*Math.pow(10,2-Math.max(o,3));while(e>u&&a<n.fileSizeLabels.length-1)a++,e/=1024;return e+=1e-15,s=Math.max(0,o-Math.floor(e).toFixed(0).length),e=Number(e.toFixed(s)),""+i+e+" "+n.fileSizeLabels[a]+r},n.ajaxDefaults={dataType:"json",crossDomain:!0,cache:!1},n.jsonp=function(t,i,r){return e.isPlainObject(i)&&(r=i,i="GET"),e.ajax(e.extend({url:t,type:i,data:r},n.ajaxDefaults)).then(function(t){var n;return t.error?(n=t.error.content||t.error,e.Deferred().reject(n)):t},function(e,i,r){var o;return o=""+i+" ("+r+")",n.warn("JSONP unexpected error: "+o+" while loading "+t),o})},n.canvasToBlob=function(e,t,n,i){var r,o,s,a,u,l;if(HTMLCanvasElement.prototype.toBlob)return e.toBlob(i,t,n);for(s=e.toDataURL(t,n),s=s.split(","),o=atob(s[1]),r=new Uint8Array(o.length),a=u=0,l=o.length;l>u;a=u+=1)r[a]=o.charCodeAt(a);return i(new Blob([r],{type:/:(.+\/.+);/.exec(s[0])[1]}))},n.taskRunner=function(e){var t,i,r,o;return o=0,t=[],i=function(){var e;return t.length?(e=t.shift(),n.defer(function(){return e(i)})):o-=1},r=function(r){return!e||e>o?(o+=1,n.defer(function(){return r(i)})):t.push(r)}},o=[["notify","progress",2],["resolve","done",0],["reject","fail",1]],n.fixedPipe=function(){var t,n;return n=arguments[0],t=2<=arguments.length?i.call(arguments,1):[],e.Deferred(function(i){return e.each(o,function(r,o){var s;return s=e.isFunction(t[o[2]])&&t[o[2]],n[o[1]](function(){var t;return t=s&&s.apply(this,arguments),t&&e.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[o[0]+"With"](this===n?i.promise():this,s?[t]:arguments)})})}).promise()}})}.call(this),function(){var t,i,r,o=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};i=n.expose,r=n.utils,t=n.jQuery,n.namespace("settings",function(s){var a,u,l,c,p,h,f,d,_,m;return u={live:!0,manualStart:!1,locale:null,localePluralize:null,localeTranslations:null,systemDialog:!1,crop:!1,previewStep:!1,imagesOnly:!1,clearable:!1,multiple:!1,multipleMax:0,multipleMin:1,multipleMaxStrict:!1,imageShrink:!1,pathValue:!0,tabs:"file camera url facebook gdrive dropbox instagram evernote flickr skydrive",preferredTypes:"",inputAcceptTypes:"",doNotStore:!1,publicKey:null,secureSignature:"",secureExpire:"",pusherKey:"79ae88bd931ea68464d9",cdnBase:"https://ucarecdn.com",urlBase:"https://upload.uploadcare.com",socialBase:"https://social.uploadcare.com",imagePreviewMaxSize:26214400,multipartMinSize:26214400,multipartPartSize:5242880,multipartMinLastPartSize:1048576,multipartConcurrency:4,multipartMaxAttempts:3,parallelDirectUploads:10,passWindowOpen:!1,scriptBase:"//ucarecdn.com/widget/"+n.version+"/uploadcare/",debugUploads:!1},d={tabs:{all:"file camera url facebook gdrive dropbox instagram evernote flickr skydrive box vk huddle","default":u.tabs}},_=function(e){return t.isArray(e)||(e=t.trim(e),e=e?e.split(" "):[]),e},a=function(e,t){var n,i,o,s,a,u,l,c;for(a=0,l=t.length;l>a;a++){if(i=t[a],s=o=_(e[i]),d.hasOwnProperty(i))for(s=[],u=0,c=o.length;c>u;u++)n=o[u],d[i].hasOwnProperty(n)?s=s.concat(_(d[i][n])):s.push(n);e[i]=r.unique(s)}return e},m=function(e,t){var n,i,o;for(i=0,o=t.length;o>i;i++)n=t[i],null!=e[n]&&(e[n]=r.normalizeUrl(e[n]));return e},l=function(e,n){var i,r,o,s;for(o=0,s=n.length;s>o;o++)i=n[o],null!=e[i]&&(r=e[i],"string"===t.type(r)?(r=t.trim(r).toLowerCase(),e[i]=!("false"===r||"disabled"===r)):e[i]=!!r);return e},c=function(e,t){var n,i,r;for(i=0,r=t.length;r>i;i++)n=t[i],null!=e[n]&&(e[n]=parseInt(e[n]));return e},h=function(e){var n,i;return i=/^([0-9]+)([x:])([0-9]+)\s*(|upscale|minimum)$/i,n=i.exec(t.trim(e.toLowerCase()))||[],{downscale:"x"===n[2],upscale:!!n[4],notLess:"minimum"===n[4],preferedSize:n.length?[+n[1],+n[3]]:void 0}},f=function(e){var n,i,o;return n=/^([0-9]+)x([0-9]+)(?:\s+(\d{1,2}|100)%)?$/i,i=n.exec(t.trim(e.toLowerCase()))||[],i.length?(o=i[1]*i[2],o>5e6?(r.warnOnce("Shrinked size can not be larger than 5MP. "+("You have set "+i[1]+"x"+i[2]+" (")+(""+Math.ceil(o/1e3/100)/10+"MP).")),!1):{quality:i[3]?i[3]/100:void 0,size:o}):!1},p=function(e){return a(e,["tabs","preferredTypes"]),m(e,["cdnBase","socialBase","urlBase","scriptBase"]),l(e,["doNotStore","imagesOnly","multiple","clearable","pathValue","previewStep","systemDialog","debugUploads","multipleMaxStrict"]),c(e,["multipleMax","multipleMin","multipartMinSize","multipartPartSize","multipartMinLastPartSize","multipartConcurrency","multipartMaxAttempts","parallelDirectUploads"]),e.crop===!1||t.isArray(e.crop)||(/^(disabled?|false|null)$/i.test(e.crop)?e.crop=!1:t.isPlainObject(e.crop)?e.crop=[e.crop]:e.crop=t.map((""+e.crop).split(","),h)),e.imageShrink&&!t.isPlainObject(e.imageShrink)&&(e.imageShrink=f(e.imageShrink)),(e.crop||e.multiple)&&(e.previewStep=!0),r.abilities.sendFileAPI||(e.systemDialog=!1),e.validators&&(e.validators=e.validators.slice()),e},i("defaults",t.extend({
allTabs:d.tabs.all},u)),s.globals=function(){var t,n,i;i={};for(t in u)n=e["UPLOADCARE_"+r.upperCase(t)],void 0!==n&&(i[t]=n);return i},s.common=r.once(function(e,n){var i;return n||(u=t.extend(u,s.globals())),i=p(t.extend(u,e||{})),i.publicKey||r.commonWarning("publicKey"),s.waitForSettings.fire(i),i}),s.build=function(e){var n;return n=t.extend({},s.common()),t.isEmptyObject(e)||(n=p(t.extend(n,e))),n},s.waitForSettings=t.Callbacks("once memory"),s.CssCollector=function(){function e(){this.urls=[],this.styles=[]}return e.prototype.addUrl=function(e){if(!/^https?:\/\//i.test(e))throw new Error("Embedded urls should be absolute. "+e);return o.call(this.urls,e)>=0?void 0:this.urls.push(e)},e.prototype.addStyle=function(e){return this.styles.push(e)},e}(),n.tabsCss=new s.CssCollector,u._emptyKeyText='<div class="uploadcare-dialog-message-center">\n<div class="uploadcare-dialog-big-title">Hello!</div>\n<div class="uploadcare-dialog-large-text">\n  <div>Your <a class="uploadcare-link" href="https://uploadcare.com/dashboard/">public key</a> is not set.</div>\n  <div>Add this to the &lt;head&gt; tag to start uploading files:</div>\n  <div class="uploadcare-pre">&lt;script&gt;\nUPLOADCARE_PUBLIC_KEY = \'your_public_key\';\n&lt;/script&gt;</div>\n</div>\n</div>'})}.call(this),function(){n.namespace("locale.translations",function(e){return e.en={uploading:"Uploading... Please wait.",loadingInfo:"Loading info...",errors:{"default":"Error",baddata:"Incorrect value",size:"File too big",upload:"Can’t upload",user:"Upload canceled",info:"Can’t load info",image:"Only images allowed",createGroup:"Can’t create file group",deleted:"File was deleted"},draghere:"Drop a file here",file:{one:"%1 file",other:"%1 files"},buttons:{cancel:"Cancel",remove:"Remove",choose:{files:{one:"Choose a file",other:"Choose files"},images:{one:"Choose an image",other:"Choose images"}}},dialog:{done:"Done",showFiles:"Show files",tabs:{names:{"empty-pubkey":"Welcome",preview:"Preview",file:"Local Files",url:"Arbitrary Links",camera:"Camera",facebook:"Facebook",dropbox:"Dropbox",gdrive:"Google Drive",instagram:"Instagram",vk:"VK",evernote:"Evernote",box:"Box",skydrive:"OneDrive",flickr:"Flickr",huddle:"Huddle"},file:{drag:"Drop a file here",nodrop:"Upload files from your computer",cloudsTip:"Cloud storages<br>and social networks",or:"or",button:"Choose a local file",also:"You can also choose it from"},url:{title:"Files from the Web",line1:"Grab any file off the web.",line2:"Just provide the link.",input:"Paste your link here...",button:"Upload"},camera:{capture:"Take a photo",mirror:"Mirror",startRecord:"Record a video",stopRecord:"Stop",cancelRecord:"Cancel",retry:"Request permissions again",pleaseAllow:{title:"Please allow access to your camera",text:"You have been prompted to allow camera access from this site. In order to take pictures with your camera you must approve this request."},notFound:{title:"No camera detected",text:"Looks like you have no camera connected to this device."}},preview:{unknownName:"unknown",change:"Cancel",back:"Back",done:"Add",unknown:{title:"Uploading... Please wait for a preview.",done:"Skip preview and accept"},regular:{title:"Add this file?",line1:"You are about to add the file above.",line2:"Please confirm."},image:{title:"Add this image?",change:"Cancel"},crop:{title:"Crop and add this image",done:"Done",free:"free"},video:{title:"Add this video?",change:"Cancel"},error:{"default":{title:"Oops!",text:"Something went wrong during the upload.",back:"Please try again"},image:{title:"Only image files are accepted.",text:"Please try again with another file.",back:"Choose image"},size:{title:"The file you selected exceeds the limit.",text:"Please try again with another file."},loadImage:{title:"Error",text:"Can’t load image"}},multiple:{title:"You’ve chosen %files%",question:"Do you want to add all of these files?",tooManyFiles:"You’ve chosen too many files. %max% is maximum.",tooFewFiles:"You’ve chosen %files%. At least %min% required.",clear:"Remove all",done:"Done"}}},footer:{text:"powered by",link:"uploadcare"}}}}),n.namespace("locale.pluralize",function(e){return e.en=function(e){return 1===e?"one":"other"}})}.call(this),function(){var e,t,i;i=n.utils,t=n.settings,e=n.jQuery,n.namespace("locale",function(n){var r,o,s,a,u;return o="en",s={lang:o,translations:n.translations[o],pluralize:n.pluralize[o]},u=function(t){var i,r,o;return i=t.locale||s.lang,o=e.extend(!0,{},n.translations[i],t.localeTranslations),r=e.isFunction(t.localePluralize)?t.localePluralize:n.pluralize[i],{lang:i,translations:o,pluralize:r}},r=i.once(function(){return u(t.build())}),n.rebuild=function(e){var n;return n=u(t.build(e)),r=function(){return n}},a=function(e,t){var n,i,r,o;for(n=e.split("."),r=0,o=n.length;o>r;r++){if(i=n[r],null==t)return null;t=t[i]}return t},n.t=function(e,t){var n,i,o;return n=r(),i=a(e,n.translations),null==i&&n.lang!==s.lang&&(n=s,i=a(e,n.translations)),null!=t&&(i=null!=n.pluralize?(null!=(o=i[n.pluralize(t)])?o.replace("%1",t):void 0)||t:""),i||""}})}.call(this),function(){var e,t,i,r,o=function(e,t){return function(){return e.apply(t,arguments)}},s=[].slice;t=n.namespace,i=n.settings,e=n.jQuery,r=n.utils,t("files",function(t){return t.BaseFile=function(){function t(t,n,i){var r;this.settings=n,this.sourceInfo=null!=i?i:{},this.__extendApi=o(this.__extendApi,this),this.__cancel=o(this.__cancel,this),this.__resolveApi=o(this.__resolveApi,this),this.__rejectApi=o(this.__rejectApi,this),this.__runValidators=o(this.__runValidators,this),this.__fileInfo=o(this.__fileInfo,this),this.__handleFileData=o(this.__handleFileData,this),this.__updateInfo=o(this.__updateInfo,this),this.__completeUpload=o(this.__completeUpload,this),this.fileId=null,this.fileName=null,this.sanitizedName=null,this.fileSize=null,this.isStored=null,this.cdnUrlModifiers=null,this.isImage=null,this.imageInfo=null,this.mimeType=null,this.s3Bucket=null,(r=this.sourceInfo).source||(r.source=this.sourceName),this.onInfoReady=e.Callbacks("once memory"),this.__setupValidation(),this.__initApi()}return t.prototype.__startUpload=function(){return e.Deferred().resolve()},t.prototype.__completeUpload=function(){var e,t,n,i,o=this;return n=0,this.settings.debugUploads&&(r.debug("Load file info.",this.fileId,this.settings.publicKey),t=setInterval(function(){return r.debug("Still waiting for file ready.",n,o.fileId,o.settings.publicKey)},5e3),this.apiDeferred.done(function(){return r.debug("File uploaded.",n,o.fileId,o.settings.publicKey)}).always(function(){return clearInterval(t)})),i=100,(e=function(){return"pending"===o.apiDeferred.state()?(n+=1,o.__updateInfo().done(function(){return setTimeout(e,i),i+=50})):void 0})()},t.prototype.__updateInfo=function(){var e=this;return r.jsonp(""+this.settings.urlBase+"/info/",{jsonerrors:1,file_id:this.fileId,pub_key:this.settings.publicKey,wait_is_ready:+this.onInfoReady.fired()}).fail(function(t){return e.settings.debugUploads&&r.log("Can't load file info. Probably removed.",e.fileId,e.settings.publicKey,t),e.__rejectApi("info")}).done(this.__handleFileData)},t.prototype.__handleFileData=function(e){return this.fileName=e.original_filename,this.sanitizedName=e.filename,this.fileSize=e.size,this.isImage=e.is_image,this.imageInfo=e.image_info,this.mimeType=e.mime_type,this.isStored=e.is_stored,this.s3Bucket=e.s3_bucket,e.default_effects&&(this.cdnUrlModifiers="-/"+e.default_effects),this.s3Bucket&&this.cdnUrlModifiers&&this.__rejectApi("baddata"),this.onInfoReady.fired()||this.onInfoReady.fire(this.__fileInfo()),e.is_ready?this.__resolveApi():void 0},t.prototype.__progressInfo=function(){var e;return{state:this.__progressState,uploadProgress:this.__progress,progress:"ready"===(e=this.__progressState)||"error"===e?1:.9*this.__progress,incompleteFileInfo:this.__fileInfo()}},t.prototype.__fileInfo=function(){var e;return e=this.s3Bucket?"https://"+this.s3Bucket+".s3.amazonaws.com/"+this.fileId+"/"+this.sanitizedName:""+this.settings.cdnBase+"/"+this.fileId+"/",{uuid:this.fileId,name:this.fileName,size:this.fileSize,isStored:this.isStored,isImage:!this.s3Bucket&&this.isImage,originalImageInfo:this.imageInfo,mimeType:this.mimeType,originalUrl:this.fileId?e:null,
cdnUrl:this.fileId?""+e+(this.cdnUrlModifiers||""):null,cdnUrlModifiers:this.cdnUrlModifiers,sourceInfo:this.sourceInfo}},t.prototype.__setupValidation=function(){return this.validators=this.settings.validators||this.settings.__validators||[],this.settings.imagesOnly&&this.validators.push(function(e){if(e.isImage===!1)throw new Error("image")}),this.onInfoReady.add(this.__runValidators)},t.prototype.__runValidators=function(e){var t,n,i,r,o,s;e=e||this.__fileInfo();try{for(o=this.validators,s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(n(e));return s}catch(a){return t=a,this.__rejectApi(t.message)}},t.prototype.__initApi=function(){return this.apiDeferred=e.Deferred(),this.__progressState="uploading",this.__progress=0,this.__notifyApi()},t.prototype.__notifyApi=function(){return this.apiDeferred.notify(this.__progressInfo())},t.prototype.__rejectApi=function(e){return this.__progressState="error",this.__notifyApi(),this.apiDeferred.reject(e,this.__fileInfo())},t.prototype.__resolveApi=function(){return this.__progressState="ready",this.__notifyApi(),this.apiDeferred.resolve(this.__fileInfo())},t.prototype.__cancel=function(){return this.__rejectApi("user")},t.prototype.__extendApi=function(e){var t=this;return e.cancel=this.__cancel,e.pipe=e.then=function(){return t.__extendApi(r.fixedPipe.apply(r,[e].concat(s.call(arguments))))},e},t.prototype.promise=function(){var e,t=this;return this.__apiPromise||(this.__apiPromise=this.__extendApi(this.apiDeferred.promise()),this.__runValidators(),"pending"===this.apiDeferred.state()&&(e=this.__startUpload(),e.done(function(){return t.__progressState="uploaded",t.__progress=1,t.__notifyApi(),t.__completeUpload()}),e.progress(function(e){return e>t.__progress?(t.__progress=e,t.__notifyApi()):void 0}),e.fail(function(){return t.__rejectApi("upload")}),this.apiDeferred.always(e.reject))),this.__apiPromise},t}()}),t("utils",function(e){return e.isFile=function(e){return e&&e.done&&e.fail&&e.cancel},e.valueToFile=function(t,i){return t&&!e.isFile(t)&&(t=n.fileFrom("uploaded",t,i)),t||null}})}.call(this),function(){var t,i,o,s,a,u,l;t=n.jQuery,a=n.utils,u=n.utils,l=u.abilities,i=l.Blob,o=l.FileReader,s=l.URL,n.namespace("utils.image",function(n){var u,l;return u=e.DataView,l=a.taskRunner(1),n.shrinkFile=function(e,r){var o,c=this;return o=t.Deferred(),s&&u&&i?(l(function(t){var i;return o.always(t),i=a.imageLoader(s.createObjectURL(e)),i.always(function(e){return s.revokeObjectURL(e.target.src)}),i.fail(function(){return o.reject("not image")}),i.done(function(t){return o.notify(.1),n.getExif(e).always(function(e){var s;return o.notify(.2),s="resolved"===this.state(),i=n.shrinkImage(t.target,r),i.progress(function(e){return o.notify(.2+.6*e)}),i.fail(o.reject),i.done(function(t){var u,l;return u="image/jpeg",l=r.quality||.8,!s&&n.hasTransparency(t)&&(u="image/png",l=void 0),a.canvasToBlob(t,u,l,function(r){return t.width=t.height=1,o.notify(.9),e?(i=n.replaceJpegChunk(r,225,[e.buffer]),i.done(o.resolve),i.fail(function(){return o.resolve(r)})):o.resolve(r)})}),t=null})})}),o.promise()):o.reject("support")},n.shrinkImage=function(e,n){var i,o,s,u,l,c,p,h,f,d,_;return i=t.Deferred(),d=.71,e.width*d*e.height*d<n.size?i.reject("not required"):(f=l=e.width,h=e.height,c=f/h,_=Math.floor(Math.sqrt(n.size*c)),o=Math.floor(n.size/Math.sqrt(n.size*c)),u=5e6,s=4096,(p=function(){return _>=f?void i.resolve(e):a.defer(function(){var t;return f=Math.round(f*d),h=Math.round(h*d),_>f*d&&(f=_,h=o),f*h>u&&(f=Math.floor(Math.sqrt(u*c)),h=Math.floor(u/Math.sqrt(u*c))),f>s&&(f=s,h=Math.round(f/c)),h>s&&(h=s,f=Math.round(c*h)),t=r.createElement("canvas"),t.width=f,t.height=h,t.getContext("2d").drawImage(e,0,0,f,h),e.src="//:0",e.width=e.height=1,e=t,i.notify((l-f)/(l-_)),p()})})(),i.promise())},n.drawFileToCanvas=function(e,i,o,u,l){var c,p;return c=t.Deferred(),s?(p=a.imageLoader(s.createObjectURL(e)),p.always(function(e){return s.revokeObjectURL(e.target.src)}),p.fail(function(){return c.reject("not image")}),p.done(function(t){var s;return s=t.target,c.always(function(){return s.src="//:0"}),l&&s.width*s.height>l?c.reject("max source"):n.getExif(e).always(function(e){var t,l,p,h,f,d,_,m,g,y;return f=n.parseExifOrientation(e)||1,_=f>4,d=_?[s.height,s.width]:[s.width,s.height],g=a.fitSize(d,[i,o]),h=g[0],p=g[1],(m=[[1,0,0,1,0,0],[-1,0,0,1,h,0],[-1,0,0,-1,h,p],[1,0,0,-1,0,p],[0,1,1,0,0,0],[0,1,-1,0,h,0],[0,-1,-1,0,h,p],[0,-1,1,0,0,p]][f-1])?(t=r.createElement("canvas"),t.width=h,t.height=p,l=t.getContext("2d"),l.transform.apply(l,m),_&&(y=[p,h],h=y[0],p=y[1]),u&&(l.fillStyle=u,l.fillRect(0,0,h,p)),l.drawImage(s,0,0,h,p),c.resolve(t,d)):c.reject("bad image")})}),c.promise()):c.reject("support")},n.readJpegChunks=function(e){var n,i,r,s,a;return a=function(e,t){var i;return i=new o,i.onload=function(){return t(new u(i.result))},i.onerror=function(e){return n.reject("reader",e)},i.readAsArrayBuffer(e)},r=function(){return a(e.slice(i,i+128),function(e){var t,n,r;for(t=n=0,r=e.byteLength;r>=0?r>n:n>r;t=r>=0?++n:--n)if(255===e.getUint8(t)){i+=t;break}return s()})},s=function(){var t;return t=i,a(e.slice(i,i+=4),function(o){var s,u;return 4!==o.byteLength||255!==o.getUint8(0)?n.reject("corrupted"):(u=o.getUint8(1),218===u?n.resolve():(s=o.getUint16(2)-2,a(e.slice(i,i+=s),function(e){return e.byteLength!==s?n.reject("corrupted"):(n.notify(t,s,u,e),r())})))})},n=t.Deferred(),o&&u?(i=2,a(e.slice(0,2),function(e){return 65496!==e.getUint16(0)?n.reject("not jpeg"):r()}),n.promise()):n.reject("support")},n.replaceJpegChunk=function(e,r,o){var s,a,l,c;return s=t.Deferred(),l=[],a=[],c=n.readJpegChunks(e),c.fail(s.reject),c.progress(function(e,t,n){return n===r?(l.push(e),a.push(t)):void 0}),c.done(function(){var t,n,c,p,h,f,d,_,m;for(p=[e.slice(0,2)],f=0,_=o.length;_>f;f++)t=o[f],c=new u(new ArrayBuffer(4)),c.setUint16(0,65280+r),c.setUint16(2,t.byteLength+2),p.push(c.buffer),p.push(t);for(h=2,n=d=0,m=l.length;m>=0?m>d:d>m;n=m>=0?++d:--d)l[n]>h&&p.push(e.slice(h,l[n])),h=l[n]+a[n]+4;return p.push(e.slice(h,e.size)),s.resolve(new i(p,{type:e.type}))}),s.promise()},n.getExif=function(e){var i,r;return i=null,r=n.readJpegChunks(e),r.progress(function(e,t,n,r){return!i&&225===n&&r.byteLength>=14&&1165519206===r.getUint32(0)&&0===r.getUint16(4)?i=r:void 0}),r.then(function(){return i},function(e){return t.Deferred().reject(i,e)})},n.parseExifOrientation=function(e){var t,n,i,r,o;if(!e||e.byteLength<14||1165519206!==e.getUint32(0)||0!==e.getUint16(4)||42!==e.getUint16(8))return null;if(18761===e.getUint16(6))i=!0;else{if(19789!==e.getUint16(6))return null;i=!1}for(r=8+e.getUint32(10,i),t=e.getUint16(r-2,i),n=o=0;t>=0?t>o:o>t;n=t>=0?++o:--o){if(e.byteLength<r+10)return null;if(274===e.getUint16(r,i))return e.getUint16(r+8,i);r+=12}return null},n.hasTransparency=function(e){var t,n,i,o,s,a,u;for(s=50,t=r.createElement("canvas"),t.width=t.height=s,n=t.getContext("2d"),n.drawImage(e,0,0,s,s),i=n.getImageData(0,0,s,s).data,t.width=t.height=1,o=a=3,u=i.length;u>a;o=a+=4)if(i[o]<254)return!0;return!1}})}.call(this),function(){var e,t,i=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,o=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=n.jQuery,t=n.utils,n.namespace("files",function(n){return n.ObjectFile=function(n){var r;o(s,n),r=null,s.prototype.sourceName="local";function s(e){this.__file=e,this.setFile=i(this.setFile,this),s.__super__.constructor.apply(this,arguments),this.fileName=this.__file.name||"original",this.__notifyApi()}return s.prototype.setFile=function(e){return e&&(this.__file=e),this.sourceInfo.file=this.__file,this.__file?(this.fileSize=this.__file.size,this.fileType=this.__file.type||"application/octet-stream",this.settings.debugUploads&&t.debug("Use local file.",this.fileName,this.fileType,this.fileSize),this.__runValidators(),this.__notifyApi()):void 0},s.prototype.__startUpload=function(){var n,i,r,o=this;return this.apiDeferred.always(function(){return o.__file=null}),this.__file.size>=this.settings.multipartMinSize&&t.abilities.Blob?(this.setFile(),this.multipartUpload()):(i=t.abilities.iOSVersion,
!this.settings.imageShrink||i&&8>i?(this.setFile(),this.directUpload()):(n=e.Deferred(),r=.4,t.image.shrinkFile(this.__file,this.settings.imageShrink).progress(function(e){return n.notify(e*r)}).done(this.setFile).fail(function(){return o.setFile(),r=.1*r}).always(function(){return n.notify(r),o.directUpload().done(n.resolve).fail(n.reject).progress(function(e){return n.notify(r+e*(1-r))})}),n))},s.prototype.__autoAbort=function(e){return this.apiDeferred.fail(e.abort),e},s.prototype.directRunner=function(e){return r||(r=t.taskRunner(this.settings.parallelDirectUploads)),r(e)},s.prototype.directUpload=function(){var t,n=this;return t=e.Deferred(),this.__file?this.fileSize>104857600?(this.__rejectApi("size"),t):(this.directRunner(function(i){var r;return t.always(i),"pending"===n.apiDeferred.state()?(r=new FormData,r.append("UPLOADCARE_PUB_KEY",n.settings.publicKey),r.append("signature",n.settings.secureSignature),r.append("expire",n.settings.secureExpire),r.append("UPLOADCARE_STORE",n.settings.doNotStore?"":"auto"),r.append("file",n.__file,n.fileName),r.append("file_name",n.fileName),r.append("source",n.sourceInfo.source),n.__autoAbort(e.ajax({xhr:function(){var n;return n=e.ajaxSettings.xhr(),n.upload&&n.upload.addEventListener("progress",function(e){return t.notify(e.loaded/e.total)},!1),n},crossDomain:!0,type:"POST",url:""+n.settings.urlBase+"/base/?jsonerrors=1",headers:{"X-PINGOTHER":"pingpong"},contentType:!1,processData:!1,data:r,dataType:"json",error:t.reject,success:function(e){return(null!=e?e.file:void 0)?(n.fileId=e.file,t.resolve()):t.reject()}}))):void 0}),t):(this.__rejectApi("baddata"),t)},s.prototype.multipartUpload=function(){var t,n=this;return t=e.Deferred(),this.__file?this.settings.imagesOnly?(this.__rejectApi("image"),t):(this.multipartStart().done(function(e){return n.uploadParts(e.parts,e.uuid).done(function(){return n.multipartComplete(e.uuid).done(function(e){return n.fileId=e.uuid,n.__handleFileData(e),t.resolve()}).fail(t.reject)}).progress(t.notify).fail(t.reject)}).fail(t.reject),t):t},s.prototype.multipartStart=function(){var e,n=this;return e={UPLOADCARE_PUB_KEY:this.settings.publicKey,signature:this.settings.secureSignature,expire:this.settings.secureExpire,filename:this.fileName,source:this.sourceInfo.source,size:this.fileSize,content_type:this.fileType,part_size:this.settings.multipartPartSize,UPLOADCARE_STORE:this.settings.doNotStore?"":"auto"},this.__autoAbort(t.jsonp(""+this.settings.urlBase+"/multipart/start/?jsonerrors=1","POST",e).fail(function(i){return n.settings.debugUploads?t.log("Can't start multipart upload.",i,e):void 0}))},s.prototype.uploadParts=function(n,i){var r,o,s,a,u,l,c,p,h,f,d,_=this;for(u=[],a=e.now(),h=function(t,n){var i,o,s;if(u[t]=n,!(e.now()-a<250)){for(a=e.now(),i=0,o=0,s=u.length;s>o;o++)n=u[o],i+=n;return r.notify(i/_.fileSize)}},r=e.Deferred(),s=0,p=0,c=0,l=function(){var o,a,f,d,m;if(!(c>=_.fileSize))return f=c+_.settings.multipartPartSize,_.fileSize<f+_.settings.multipartMinLastPartSize&&(f=_.fileSize),a=_.__file.slice(c,f),c=f,d=p,s+=1,p+=1,o=0,(m=function(){return"pending"===_.apiDeferred.state()?(u[d]=0,_.__autoAbort(e.ajax({xhr:function(){var t;return t=e.ajaxSettings.xhr(),t.upload&&t.upload.addEventListener("progress",function(e){return h(d,e.loaded)},!1),t},url:n[d],crossDomain:!0,type:"PUT",processData:!1,contentType:_.fileType,data:a,error:function(){return o+=1,o>_.settings.multipartMaxAttempts?(_.settings.debugUploads&&t.info("Part #"+d+" and file upload is failed.",i),r.reject()):(_.settings.debugUploads&&t.debug("Part #"+d+"("+o+") upload is failed.",i),m())},success:function(){return s-=1,l(),s?void 0:r.resolve()}}))):void 0})()},o=f=0,d=this.settings.multipartConcurrency;d>=0?d>f:f>d;o=d>=0?++f:--f)l();return r},s.prototype.multipartComplete=function(e){var n,i=this;return n={UPLOADCARE_PUB_KEY:this.settings.publicKey,uuid:e},this.__autoAbort(t.jsonp(""+this.settings.urlBase+"/multipart/complete/?jsonerrors=1","POST",n).fail(function(n){return i.settings.debugUploads?t.log("Can't complete multipart upload.",e,i.settings.publicKey,n):void 0}))},s}(n.BaseFile)})}.call(this),function(){var e,t,i=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,o=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=n.jQuery,t=n.utils,n.namespace("files",function(n){return n.InputFile=function(n){o(r,n),r.prototype.sourceName="local-compat";function r(n){this.__input=n,this.__cleanUp=i(this.__cleanUp,this),r.__super__.constructor.apply(this,arguments),this.fileId=t.uuid(),this.fileName=e(this.__input).val().split("\\").pop(),this.__notifyApi()}return r.prototype.__startUpload=function(){var t,n,i,r;return t=e.Deferred(),r=""+this.settings.urlBase+"/iframe/",i="uploadcare-iframe-"+this.fileId,this.__iframe=e("<iframe>").attr({id:i,name:i}).css("display","none").appendTo("body").on("load",t.resolve).on("error",t.reject),n=function(t,n){return e("<input/>",{type:"hidden",name:t,value:n})},e(this.__input).attr("name","file"),this.__iframeForm=e("<form>").attr({method:"POST",action:r,enctype:"multipart/form-data",target:i}).append(n("UPLOADCARE_PUB_KEY",this.settings.publicKey)).append(n("UPLOADCARE_SIGNATURE",this.settings.secureSignature)).append(n("UPLOADCARE_EXPIRE",this.settings.secureExpire)).append(n("UPLOADCARE_FILE_ID",this.fileId)).append(n("UPLOADCARE_STORE",this.settings.doNotStore?"":"auto")).append(n("UPLOADCARE_SOURCE",this.sourceInfo.source)).append(this.__input).css("display","none").appendTo("body").submit(),t.always(this.__cleanUp)},r.prototype.__cleanUp=function(){var e,t;return null!=(e=this.__iframe)&&e.off("load error").remove(),null!=(t=this.__iframeForm)&&t.remove(),this.__iframe=null,this.__iframeForm=null},r}(n.BaseFile)})}.call(this),function(){var t,n;!function(){void 0===Function.prototype.scopedTo&&(Function.prototype.scopedTo=function(e,t){var n=this;return function(){return n.apply(e,Array.prototype.slice.call(t||[]).concat(Array.prototype.slice.call(arguments)))}}),t=function(e,n){this.options=n||{},this.key=e,this.channels=new t.Channels,this.global_emitter=new t.EventsDispatcher;var i=this;this.checkAppKey(),this.connection=new t.Connection(this.key,this.options),this.connection.bind("connected",function(){i.subscribeAll()}).bind("message",function(e){var t=0===e.event.indexOf("pusher_internal:");if(e.channel){var n;(n=i.channel(e.channel))&&n.emit(e.event,e.data)}t||i.global_emitter.emit(e.event,e.data)}).bind("disconnected",function(){i.channels.disconnect()}).bind("error",function(e){t.warn("Error",e)}),t.instances.push(this),t.isReady&&i.connect()},t.instances=[],t.prototype={channel:function(e){return this.channels.find(e)},connect:function(){this.connection.connect()},disconnect:function(){this.connection.disconnect()},bind:function(e,t){return this.global_emitter.bind(e,t),this},bind_all:function(e){return this.global_emitter.bind_all(e),this},subscribeAll:function(){var e;for(channelName in this.channels.channels)this.channels.channels.hasOwnProperty(channelName)&&this.subscribe(channelName)},subscribe:function(e){var t=this,n=this.channels.add(e,this);return"connected"===this.connection.state&&n.authorize(this.connection.socket_id,this.options,function(i,r){i?n.emit("pusher:subscription_error",r):t.send_event("pusher:subscribe",{channel:e,auth:r.auth,channel_data:r.channel_data})}),n},unsubscribe:function(e){this.channels.remove(e),"connected"===this.connection.state&&this.send_event("pusher:unsubscribe",{channel:e})},send_event:function(e,t,n){return this.connection.send_event(e,t,n)},checkAppKey:function(){(null===this.key||void 0===this.key)&&t.warn("Warning","You must pass your app key when you instantiate Pusher.")}},t.Util={extend:function n(e,t){for(var i in t)t[i]&&t[i].constructor&&t[i].constructor===Object?e[i]=n(e[i]||{},t[i]):e[i]=t[i];return e},stringify:function r(){for(var t=["Pusher"],n=0;n<arguments.length;n++)"string"==typeof arguments[n]?t.push(arguments[n]):void 0==e.JSON?t.push(arguments[n].toString()):t.push(JSON.stringify(arguments[n]));return t.join(" : ")},arrayIndexOf:function(e,t){
var n=Array.prototype.indexOf;if(null==e)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(i=0,l=e.length;i<l;i++)if(e[i]===t)return i;return-1}},t.debug=function(){t.log&&t.log(t.Util.stringify.apply(this,arguments))},t.warn=function(){if(e.console&&e.console.warn)e.console.warn(t.Util.stringify.apply(this,arguments));else{if(!t.log)return;t.log(t.Util.stringify.apply(this,arguments))}},t.VERSION="1.12.2",t.host="ws.pusherapp.com",t.ws_port=80,t.wss_port=443,t.channel_auth_endpoint="/pusher/auth",t.cdn_http="http://js.pusher.com/",t.cdn_https="https://d3dy5gmtp8yhk7.cloudfront.net/",t.dependency_suffix=".min",t.channel_auth_transport="ajax",t.activity_timeout=12e4,t.pong_timeout=3e4,t.isReady=!1,t.ready=function(){t.isReady=!0;for(var e=0,n=t.instances.length;n>e;e++)t.instances[e].connect()}}(),function(){function e(){this._callbacks={}}e.prototype.get=function(e){return this._callbacks[this._prefix(e)]},e.prototype.add=function(e,t){var n=this._prefix(e);this._callbacks[n]=this._callbacks[n]||[],this._callbacks[n].push(t)},e.prototype.remove=function(e,n){if(this.get(e)){var i=t.Util.arrayIndexOf(this.get(e),n);this._callbacks[this._prefix(e)].splice(i,1)}},e.prototype._prefix=function(e){return"_"+e};function n(t){this.callbacks=new e,this.global_callbacks=[],this.failThrough=t}n.prototype.bind=function(e,t){return this.callbacks.add(e,t),this},n.prototype.unbind=function(e,t){return this.callbacks.remove(e,t),this},n.prototype.emit=function(e,t){for(var n=0;n<this.global_callbacks.length;n++)this.global_callbacks[n](e,t);var i=this.callbacks.get(e);if(i)for(var n=0;n<i.length;n++)i[n](t);else this.failThrough&&this.failThrough(e,t);return this},n.prototype.bind_all=function(e){return this.global_callbacks.push(e),this},t.EventsDispatcher=n}(),function(){function e(e){return e.substr(0,1).toUpperCase()+e.substr(1)}function n(e,t,n){void 0!==t[e]&&t[e](n)}function i(e,n,i){t.EventsDispatcher.call(this),this.state=void 0,this.errors=[],this.stateActions=i,this.transitions=n,this.transition(e)}i.prototype.transition=function(i,r){var o=this.state,s=this.stateActions;if(o&&-1==t.Util.arrayIndexOf(this.transitions[o],i))throw this.emit("invalid_transition_attempt",{oldState:o,newState:i}),new Error("Invalid transition ["+o+" to "+i+"]");n(o+"Exit",s,r),n(o+"To"+e(i),s,r),n(i+"Pre",s,r),this.state=i,this.emit("state_change",{oldState:o,newState:i}),n(i+"Post",s,r)},i.prototype.is=function(e){return this.state===e},i.prototype.isNot=function(e){return this.state!==e},t.Util.extend(i.prototype,t.EventsDispatcher.prototype),t.Machine=i}(),function(){var n=function(){var n=this;t.EventsDispatcher.call(this),void 0!==e.addEventListener&&(e.addEventListener("online",function(){n.emit("online",null)},!1),e.addEventListener("offline",function(){n.emit("offline",null)},!1))};n.prototype.isOnLine=function(){return void 0===e.navigator.onLine?!0:e.navigator.onLine},t.Util.extend(n.prototype,t.EventsDispatcher.prototype),t.NetInfo=n}(),function(){var e={initialized:["waiting","failed"],waiting:["connecting","permanentlyClosed"],connecting:["open","permanentlyClosing","impermanentlyClosing","waiting"],open:["connected","permanentlyClosing","impermanentlyClosing","waiting"],connected:["permanentlyClosing","waiting"],impermanentlyClosing:["waiting","permanentlyClosing"],permanentlyClosing:["permanentlyClosed"],permanentlyClosed:["waiting","failed"],failed:["permanentlyClosed"]},n=2e3,i=2e3,o=2e3,s=5*n,a=5*i,u=5*o;function l(e){e.connectionWait=0,"flash"===t.TransportType?e.openTimeout=5e3:e.openTimeout=2e3,e.connectedTimeout=2e3,e.connectionSecure=e.compulsorySecure,e.connectionAttempts=0}function c(c,p){var h=this;t.EventsDispatcher.call(this),this.options=t.Util.extend({encrypted:!1},p),this.netInfo=new t.NetInfo,this.netInfo.bind("online",function(){h._machine.is("waiting")&&(h._machine.transition("connecting"),A("connecting"))}),this.netInfo.bind("offline",function(){h._machine.is("connected")&&(h.socket.onclose=void 0,h.socket.onmessage=void 0,h.socket.onerror=void 0,h.socket.onopen=void 0,h.socket.close(),h.socket=void 0,h._machine.transition("waiting"))}),this._machine=new t.Machine("initialized",e,{initializedPre:function(){h.compulsorySecure=h.options.encrypted,h.key=c,h.socket=null,h.socket_id=null,h.state="initialized"},waitingPre:function(){h.connectionWait>0&&h.emit("connecting_in",h.connectionWait),A(h.netInfo.isOnLine()&&h.connectionAttempts<=4?"connecting":"unavailable"),h.netInfo.isOnLine()&&(h._waitingTimer=setTimeout(function(){h._machine.transition("connecting")},y()))},waitingExit:function(){clearTimeout(h._waitingTimer)},connectingPre:function(){if(h.netInfo.isOnLine()===!1)return h._machine.transition("waiting"),void A("unavailable");var e=d(h.key,h.connectionSecure);t.debug("Connecting",e),h.socket=new t.Transport(e),h.socket.onopen=v,h.socket.onclose=S,h.socket.onerror=C,h._connectingTimer=setTimeout(_,h.openTimeout)},connectingExit:function(){clearTimeout(h._connectingTimer),h.socket.onopen=void 0},connectingToWaiting:function(){f()},connectingToImpermanentlyClosing:function(){f()},openPre:function(){h.socket.onmessage=w,h.socket.onerror=C,h.socket.onclose=S,h._openTimer=setTimeout(_,h.connectedTimeout)},openExit:function(){clearTimeout(h._openTimer),h.socket.onmessage=void 0},openToWaiting:function(){f()},openToImpermanentlyClosing:function(){f()},connectedPre:function(e){h.socket_id=e,h.socket.onmessage=x,h.socket.onerror=C,h.socket.onclose=S,l(h),h.connectedAt=(new Date).getTime(),m()},connectedPost:function(){A("connected")},connectedExit:function(){g(),A("disconnected")},impermanentlyClosingPost:function(){h.socket&&(h.socket.onclose=S,h.socket.close())},permanentlyClosingPost:function(){h.socket?(h.socket.onclose=function(){l(h),h._machine.transition("permanentlyClosed")},h.socket.close()):(l(h),h._machine.transition("permanentlyClosed"))},failedPre:function(){A("failed"),t.debug("WebSockets are not available in this browser.")},permanentlyClosedPost:function(){A("disconnected")}});function f(){h.connectionWait<s&&(h.connectionWait+=n),h.openTimeout<a&&(h.openTimeout+=i),h.connectedTimeout<u&&(h.connectedTimeout+=o),h.compulsorySecure!==!0&&(h.connectionSecure=!h.connectionSecure),h.connectionAttempts++}function d(e,n){var i=t.ws_port,o="ws://";(n||"https:"===r.location.protocol)&&(i=t.wss_port,o="wss://");var s="flash"===t.TransportType?"true":"false";return o+t.host+":"+i+"/app/"+e+"?protocol=5&client=js&version="+t.VERSION+"&flash="+s}function _(){h._machine.transition("impermanentlyClosing")}function m(){h._activityTimer&&clearTimeout(h._activityTimer),h._activityTimer=setTimeout(function(){h.send_event("pusher:ping",{}),h._activityTimer=setTimeout(function(){h.socket.close()},h.options.pong_timeout||t.pong_timeout)},h.options.activity_timeout||t.activity_timeout)}function g(){h._activityTimer&&clearTimeout(h._activityTimer)}function y(){var e=h.connectionWait;if(0===e&&h.connectedAt){var t=1e3,n=(new Date).getTime()-h.connectedAt;t>n&&(e=t-n)}return e}function v(){h._machine.transition("open")}function b(e,t){h.emit("error",{type:"PusherError",data:{code:e,message:t}}),4e3===e?(h.compulsorySecure=!0,h.connectionSecure=!0,h.options.encrypted=!0,_()):4100>e?h._machine.transition("permanentlyClosing"):4200>e?(h.connectionWait=1e3,h._machine.transition("waiting")):4300>e?_():h._machine.transition("permanentlyClosing")}function w(e){var t=k(e);void 0!==t&&("pusher:connection_established"===t.event?h._machine.transition("connected",t.data.socket_id):"pusher:error"===t.event&&b(t.data.code,t.data.message))}function x(e){m();var n=k(e);if(void 0!==n){switch(t.debug("Event recd",n),n.event){case"pusher:error":h.emit("error",{type:"PusherError",data:n.data});break;case"pusher:ping":h.send_event("pusher:pong",{})}h.emit("message",n)}}function k(e){try{var t=JSON.parse(e.data);if("string"==typeof t.data)try{t.data=JSON.parse(t.data)}catch(n){if(!(n instanceof SyntaxError))throw n}return t}catch(n){h.emit("error",{type:"MessageParseError",error:n,data:e.data})}}function S(){h._machine.transition("waiting")}function C(e){h.emit("error",{type:"WebSocketError",error:e})}function A(e,n){var i=h.state;h.state=e,i!==e&&(t.debug("State changed",i+" -> "+e),
h.emit("state_change",{previous:i,current:e}),h.emit(e,n))}}c.prototype.connect=function(){this._machine.is("failed")||t.Transport?this._machine.is("initialized")?(l(this),this._machine.transition("waiting")):this._machine.is("waiting")&&this.netInfo.isOnLine()===!0?this._machine.transition("connecting"):this._machine.is("permanentlyClosed")&&(l(this),this._machine.transition("waiting")):this._machine.transition("failed")},c.prototype.send=function(e){if(this._machine.is("connected")){var t=this;return setTimeout(function(){t.socket.send(e)},0),!0}return!1},c.prototype.send_event=function(e,n,i){var r={event:e,data:n};return i&&(r.channel=i),t.debug("Event sent",r),this.send(JSON.stringify(r))},c.prototype.disconnect=function(){this._machine.is("permanentlyClosed")||(this._machine.is("waiting")||this._machine.is("failed")?this._machine.transition("permanentlyClosed"):this._machine.transition("permanentlyClosing"))},t.Util.extend(c.prototype,t.EventsDispatcher.prototype),t.Connection=c}(),function(){t.Channels=function(){this.channels={}},t.Channels.prototype={add:function(e,n){var i=this.find(e);if(i)return i;var r=t.Channel.factory(e,n);return this.channels[e]=r,r},find:function(e){return this.channels[e]},remove:function(e){delete this.channels[e]},disconnect:function(){for(var e in this.channels)this.channels[e].disconnect()}},t.Channel=function(e,n){var i=this;t.EventsDispatcher.call(this,function(n,i){t.debug("No callbacks on "+e+" for "+n)}),this.pusher=n,this.name=e,this.subscribed=!1,this.bind("pusher_internal:subscription_succeeded",function(e){i.onSubscriptionSucceeded(e)})},t.Channel.prototype={init:function(){},disconnect:function(){this.subscribed=!1,this.emit("pusher_internal:disconnected")},onSubscriptionSucceeded:function(e){this.subscribed=!0,this.emit("pusher:subscription_succeeded")},authorize:function(e,t,n){return n(!1,{})},trigger:function(e,t){return this.pusher.send_event(e,t,this.name)}},t.Util.extend(t.Channel.prototype,t.EventsDispatcher.prototype),t.Channel.PrivateChannel={authorize:function(e,n,i){var r=this,o=new t.Channel.Authorizer(this,t.channel_auth_transport,n);return o.authorize(e,function(e,t){e||r.emit("pusher_internal:authorized",t),i(e,t)})}},t.Channel.PresenceChannel={init:function(){this.members=new e(this)},onSubscriptionSucceeded:function(e){this.subscribed=!0}};var e=function(e){var t=this,n=function(){this._members_map={},this.count=0,this.me=null};n.call(this),e.bind("pusher_internal:authorized",function(n){var i=JSON.parse(n.channel_data);e.bind("pusher_internal:subscription_succeeded",function(n){t._members_map=n.presence.hash,t.count=n.presence.count,t.me=t.get(i.user_id),e.emit("pusher:subscription_succeeded",t)})}),e.bind("pusher_internal:member_added",function(n){null===t.get(n.user_id)&&t.count++,t._members_map[n.user_id]=n.user_info,e.emit("pusher:member_added",t.get(n.user_id))}),e.bind("pusher_internal:member_removed",function(n){var i=t.get(n.user_id);i&&(delete t._members_map[n.user_id],t.count--,e.emit("pusher:member_removed",i))}),e.bind("pusher_internal:disconnected",function(){n.call(t)})};e.prototype={each:function(e){for(var t in this._members_map)e(this.get(t))},get:function(e){return this._members_map.hasOwnProperty(e)?{id:e,info:this._members_map[e]}:null}},t.Channel.factory=function(e,n){var i=new t.Channel(e,n);return 0===e.indexOf("private-")?t.Util.extend(i,t.Channel.PrivateChannel):0===e.indexOf("presence-")&&(t.Util.extend(i,t.Channel.PrivateChannel),t.Util.extend(i,t.Channel.PresenceChannel)),i.init(),i}}(),function(){t.Channel.Authorizer=function(e,t,n){this.channel=e,this.type=t,this.authOptions=(n||{}).auth||{}},t.Channel.Authorizer.prototype={composeQuery:function(e){var t="&socket_id="+encodeURIComponent(e)+"&channel_name="+encodeURIComponent(this.channel.name);for(var n in this.authOptions.params)t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(this.authOptions.params[n]);return t},authorize:function(e,n){return t.authorizers[this.type].call(this,e,n)}},t.auth_callbacks={},t.authorizers={ajax:function(n,i){var r=this,o;o=t.XHR?new t.XHR:e.XMLHttpRequest?new e.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),o.open("POST",t.channel_auth_endpoint,!0),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var s in this.authOptions.headers)o.setRequestHeader(s,this.authOptions.headers[s]);return o.onreadystatechange=function(){if(4==o.readyState)if(200==o.status){var e,n=!1;try{e=JSON.parse(o.responseText),n=!0}catch(r){i(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+o.responseText)}n&&i(!1,e)}else t.warn("Couldn't get auth info from your webapp",o.status),i(!0,o.status)},o.send(this.composeQuery(n)),o},jsonp:function(e,n){void 0!==this.authOptions.headers&&t.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var i=r.createElement("script");t.auth_callbacks[this.channel.name]=function(e){n(!1,e)};var o="Pusher.auth_callbacks['"+this.channel.name+"']";i.src=t.channel_auth_endpoint+"?callback="+encodeURIComponent(o)+this.composeQuery(e);var s=r.getElementsByTagName("head")[0]||r.documentElement;s.insertBefore(i,s.firstChild)}}}();var n=function(){function e(e,t){r.addEventListener?e.addEventListener("load",t,!1):e.attachEvent("onreadystatechange",function(){("loaded"==e.readyState||"complete"==e.readyState)&&t()})}function t(t,n){var i=r.getElementsByTagName("head")[0],o=r.createElement("script");o.setAttribute("src",t),o.setAttribute("type","text/javascript"),o.setAttribute("async",!0),e(o,function(){n()}),i.appendChild(o)}return function(e,n){for(var i=0,r=0;r<e.length;r++)t(e[r],function(){e.length==++i&&setTimeout(n,0)})}}();!function(){!e.WebSocket&&e.MozWebSocket&&(e.WebSocket=e.MozWebSocket),e.WebSocket&&(t.Transport=e.WebSocket,t.TransportType="native");var i="http:"==r.location.protocol?t.cdn_http:t.cdn_https,o=i+t.VERSION,s=[];e.JSON||s.push(o+"/json2"+t.dependency_suffix+".js"),e.WebSocket||(e.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,s.push(o+"/flashfallback"+t.dependency_suffix+".js"));var a=function(){return e.WebSocket?function(){t.ready()}:function(){e.WebSocket?(t.Transport=e.WebSocket,t.TransportType="flash",e.WEB_SOCKET_SWF_LOCATION="https://s3.amazonaws.com/uploadcare-static/WebSocketMainInsecure.swf",WebSocket.__addTask(function(){t.ready()}),WebSocket.__initialize()):(t.Transport=null,t.TransportType="none",t.ready())}}(),u=function(e){var t=function(){r.body?e():setTimeout(t,0)};t()},l=function(){u(a)};s.length>0?n(s,l):l()}(),this.Pusher=t}.call(n),function(){var e,t={}.hasOwnProperty,i=function(e,n){for(var i in n)t.call(n,i)&&(e[i]=n[i]);function r(){this.constructor=e}return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};e=n.jQuery,n.namespace("utils.pusher",function(t){var r,o,s;return o={},n.Pusher.prototype.constructor=n.Pusher,r=function(t){i(n,t);function n(){return s=n.__super__.constructor.apply(this,arguments)}return n.prototype.subscribe=function(e){return this.disconnectTimeout&&(clearTimeout(this.disconnectTimeout),this.disconnectTimeout=null),this.connect(),n.__super__.subscribe.apply(this,arguments)},n.prototype.unsubscribe=function(t){var i=this;return n.__super__.unsubscribe.apply(this,arguments),e.isEmptyObject(this.channels.channels)?this.disconnectTimeout=setTimeout(function(){return i.disconnectTimeout=null,i.disconnect()},5e3):void 0},n}(n.Pusher),t.getPusher=function(e){return null==o[e]&&(o[e]=new r(e)),o[e].connect(),o[e]}})}.call(this),function(){var e,t,i,r=function(e,t){return function(){return e.apply(t,arguments)}},o={}.hasOwnProperty,s=function(e,t){for(var n in t)o.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};e=n.jQuery,i=n.utils,t=n.utils.pusher,n.namespace("files",function(n){var o,a;return n.UrlFile=function(t){s(n,t),n.prototype.sourceName="url",n.prototype.allEvents="progress success error fail";function n(e){var t,o;if(this.__url=e,this.__listenWatcher=r(this.__listenWatcher,this),n.__super__.constructor.apply(this,arguments),o=i.splitUrlRegex.exec(this.__url)[3].split("/").pop())try{this.fileName=decodeURIComponent(o);
}catch(s){t=s,this.fileName=o}this.__notifyApi()}return n.prototype.setName=function(e){return this.fileName=e,this.__realFileName=e,this.__notifyApi()},n.prototype.setIsImage=function(e){return this.isImage=e,this.__notifyApi()},n.prototype.__startUpload=function(){var t,n,r,s,u=this;return n=e.Deferred(),s=new a(this.settings),r=new o(this.settings),t={pub_key:this.settings.publicKey,signature:this.settings.secureSignature,expire:this.settings.secureExpire,source_url:this.__url,filename:this.__realFileName||"",source:this.sourceInfo.source,store:this.settings.doNotStore?"":"auto",jsonerrors:1},i.defer(function(){return"pending"===u.apiDeferred.state()?i.jsonp(""+u.settings.urlBase+"/from_url/",t).fail(function(e){return u.settings.debugUploads&&i.debug("Can't start upload from URL.",e,t),n.reject()}).done(function(t){var o;if("pending"===u.apiDeferred.state())return u.settings.debugUploads&&(i.debug("Start watchers.",t.token),o=setInterval(function(){return i.debug("Still watching.",t.token)},5e3),n.done(function(){return i.debug("Stop watchers.",t.token)}).always(function(){return clearInterval(o)})),u.__listenWatcher(n,e([s,r])),n.always(function(){return e([s,r]).off(u.allEvents),s.stopWatching(),r.stopWatching()}),e(s).one(u.allEvents,function(){return r.interval?(u.settings.debugUploads&&i.debug("Start using pusher.",t.token),r.stopWatching()):void 0}),s.watch(t.token),r.watch(t.token)}):void 0}),n},n.prototype.__listenWatcher=function(t,n){var i=this;return n.on("progress",function(e,n){return i.fileSize=n.total,t.notify(n.done/n.total)}).on("success",function(n,r){return e(n.target).trigger("progress",r),i.fileId=r.uuid,i.__handleFileData(r),t.resolve()}).on("error fail",t.reject)},n}(n.BaseFile),a=function(){function n(e){this.settings=e;try{this.pusher=t.getPusher(this.settings.pusherKey)}catch(n){this.pusher=null}}return n.prototype.watch=function(t){var n,i=this;return this.token=t,this.pusher?(n=this.pusher.subscribe("task-status-"+this.token),n.bind_all(function(t,n){return e(i).trigger(t,n)})):void 0},n.prototype.stopWatching=function(){return this.pusher?this.pusher.unsubscribe("task-status-"+this.token):void 0},n}(),o=function(){function t(e){this.settings=e,this.poolUrl=""+this.settings.urlBase+"/from_url/status/"}return t.prototype.watch=function(e){var t,n=this;return this.token=e,(t=function(){return n.interval=setTimeout(function(){return n.__updateStatus().done(function(){return n.interval?t():void 0})},333)})()},t.prototype.stopWatching=function(){return this.interval&&clearTimeout(this.interval),this.interval=null},t.prototype.__updateStatus=function(){var t=this;return i.jsonp(this.poolUrl,{token:this.token}).fail(function(n){return e(t).trigger("error")}).done(function(n){return e(t).trigger(n.status,n)})},t}()})}.call(this),function(){var e,t,i={}.hasOwnProperty,r=function(e,t){for(var n in t)i.call(t,n)&&(e[n]=t[n]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};e=n.jQuery,t=n.utils,n.namespace("files",function(e){return e.UploadedFile=function(e){r(n,e),n.prototype.sourceName="uploaded";function n(e){var i;n.__super__.constructor.apply(this,arguments),i=t.splitCdnUrl(e),i?(this.fileId=i[1],i[2]&&(this.cdnUrlModifiers=i[2])):this.__rejectApi("baddata")}return n}(e.BaseFile),e.ReadyFile=function(e){r(t,e),t.prototype.sourceName="uploaded";function t(e){t.__super__.constructor.apply(this,arguments),e?(this.fileId=e.uuid,this.__handleFileData(e)):this.__rejectApi("deleted")}return t}(e.BaseFile)})}.call(this),function(){var e,t,i,r,o,s,a=[].slice,u={}.hasOwnProperty,l=function(e,t){for(var n in t)u.call(t,n)&&(e[n]=t[n]);function i(){this.constructor=e}return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};t=n.namespace,e=n.jQuery,o=n.utils,s=n.locale,r=s.t,i=n.settings,t("files",function(t){return t.FileGroup=function(){function t(t,n){var r=this;this.__uuid=null,this.settings=i.build(n),this.__fileColl=new o.CollectionOfPromises(t),this.__allFilesDf=e.when.apply(e,this.files()),this.__fileInfosDf=function(){var n;return t=function(){var t,i,r,o;for(r=this.files(),o=[],t=0,i=r.length;i>t;t++)n=r[t],o.push(n.then(null,function(t,n){return e.when(n)}));return o}.call(r),e.when.apply(e,t)}(),this.__createGroupDf=e.Deferred(),this.__initApiDeferred()}return t.prototype.files=function(){return this.__fileColl.get()},t.prototype.__save=function(){var e=this;return this.__saved?void 0:(this.__saved=!0,this.__allFilesDf.done(function(){return e.__createGroup().done(function(t){return e.__uuid=t.id,e.__buildInfo(function(t){return e.settings.imagesOnly&&!t.isImage?e.__createGroupDf.reject("image",t):e.__createGroupDf.resolve(t)})}).fail(function(){return e.__createGroupDf.reject("createGroup")})}))},t.prototype.promise=function(){return this.__save(),this.__apiDf.promise()},t.prototype.__initApiDeferred=function(){var t,n,i,r=this;return this.__apiDf=e.Deferred(),this.__progressState="uploading",n=function(e){return r.__buildInfo(function(t){return r.__apiDf.reject(e,t)})},i=function(e){return r.__apiDf.resolve(e)},t=function(){return r.__apiDf.notify(r.__progressInfo())},t(),this.__fileColl.onAnyProgress(t),this.__allFilesDf.done(function(){return r.__progressState="uploaded",t()}).fail(n),this.__createGroupDf.done(function(e){return r.__progressState="ready",t(),i(e)}).fail(n)},t.prototype.__progressInfo=function(){var e,t,n,i,r;for(e=0,n=this.__fileColl.lastProgresses(),i=0,r=n.length;r>i;i++)t=n[i],e+=((null!=t?t.progress:void 0)||0)/n.length;return{state:this.__progressState,uploadProgress:e,progress:"ready"===this.__progressState?1:.9*e}},t.prototype.__buildInfo=function(e){var t;return t={uuid:this.__uuid,cdnUrl:this.__uuid?""+this.settings.cdnBase+"/"+this.__uuid+"/":null,name:r("file",this.__fileColl.length()),count:this.__fileColl.length(),size:0,isImage:!0,isStored:!0},this.__fileInfosDf.done(function(){var n,i,r,o;for(n=1<=arguments.length?a.call(arguments,0):[],i=0,o=n.length;o>i;i++)r=n[i],t.size+=r.size,r.isImage||(t.isImage=!1),r.isStored||(t.isStored=!1);return e(t)})},t.prototype.__createGroup=function(){var t,n=this;return t=e.Deferred(),this.__fileColl.length()?this.__fileInfosDf.done(function(){var e,i;return i=1<=arguments.length?a.call(arguments,0):[],o.jsonp(""+n.settings.urlBase+"/group/","POST",{pub_key:n.settings.publicKey,files:function(){var t,n,r;for(r=[],t=0,n=i.length;n>t;t++)e=i[t],r.push("/"+e.uuid+"/"+(e.cdnUrlModifiers||""));return r}()}).fail(function(e){return n.settings.debugUploads&&o.log("Can't create group.",n.settings.publicKey,e),t.reject()}).done(t.resolve)}):t.reject(),t.promise()},t.prototype.api=function(){return this.__api||(this.__api=o.bindAll(this,["promise","files"])),this.__api},t}(),t.SavedFileGroup=function(e){l(t,e);function t(e,i){var r;this.__data=e,r=n.filesFrom("ready",this.__data.files,i),t.__super__.constructor.call(this,r,i)}return t.prototype.__createGroup=function(){return o.wrapToPromise(this.__data)},t}(t.FileGroup)}),t("",function(t){return t.FileGroup=function(e,t){var i,r,s,a,u,l,c,p;for(null==e&&(e=[]),r=[],a=0,l=e.length;l>a;a++)if(s=e[a],o.isFile(s))r.push(s);else if(o.isFileGroup(s))for(p=s.files(),u=0,c=p.length;c>u;u++)i=p[u],r.push(i);return new n.files.FileGroup(r,t).api()},t.loadFileGroup=function(t,r){var s,a,u=this;return r=i.build(r),s=e.Deferred(),a=o.groupIdRegex.exec(t),a?o.jsonp(""+r.urlBase+"/group/info/",{jsonerrors:1,pub_key:r.publicKey,group_id:a[0]}).fail(function(e){return r.debugUploads&&o.log("Can't load group info. Probably removed.",a[0],r.publicKey,e),s.reject()}).done(function(e){var t;return t=new n.files.SavedFileGroup(e,r),s.resolve(t.api())}):s.reject(),s.promise()}}),t("utils",function(t){return t.isFileGroup=function(e){return e&&e.files&&e.promise},t.valueToGroup=function(i,r){var o,s;if(i)if(e.isArray(i))o=function(){var e,n,o;for(o=[],e=0,n=i.length;n>e;e++)s=i[e],o.push(t.valueToFile(s,r));return o}(),i=n.FileGroup(o,r);else if(!t.isFileGroup(i))return n.loadFileGroup(i,r);return t.wrapToPromise(i||null)},t.isFileGroupsEqual=function(e,n){var i,r,o,s,a,u;if(e===n)return!0;if(!t.isFileGroup(e)||!t.isFileGroup(n))return!1;if(r=e.files(),
o=n.files(),r.length!==o.length)return!1;for(s=a=0,u=r.length;u>a;s=++a)if(i=r[s],i!==o[s])return!1;return!0}})}.call(this),function(){var e,t,i,r;r=n.utils,e=n.jQuery,t=n.files,i=n.settings,n.namespace("",function(n){var r;return n.fileFrom=function(e,t,i){return n.filesFrom(e,[t],i)[0]},n.filesFrom=function(t,n,o){var s,a,u,l,c;for(o=i.build(o||{}),c=[],u=0,l=n.length;l>u;u++)a=n[u],s=null,e.isArray(a)&&(s=a[1],a=a[0]),c.push(new r[t](a,o,s).promise());return c},r={object:t.ObjectFile,input:t.InputFile,url:t.UrlFile,uploaded:t.UploadedFile,ready:t.ReadyFile}})}.call(this),function(){var e,t;e=n.expose,e("globals",n.settings.common),e("start",n.settings.common),e("fileFrom"),e("filesFrom"),e("FileGroup"),e("loadFileGroup"),e("locales",function(){var e;e=[];for(t in n.locale.translations)e.push(t);return e}())}.call(this),n.__exports});